<?xml version="1.0" encoding="UTF-8"?>

<project name="drush-database" default="database:update">

  <!-- ## Properties -->

  <property name="drush.bin"    value="${project.basedir}/bin/drush" />
  <property name="drush.source" value="" />
  <property name="drush.target" value="" />
  <property name="drush.tmpdir" value="/tmp" />

  <!-- ## Targets -->

  <target name="database:update"
          description="Performs database updates.">
    <exec command="${drush.bin} ${drush.target} updb -y"
          passthru="true"
          logoutput="true"
          checkreturn="true" />
  </target>

  <target name="database:drop"
          description="Drops the target database.">
    <exec command="${drush.bin} ${drush.target} sql-drop -y"
          passthru="true"
          logoutput="true"
          checkreturn="true" />
  </target>

  <target name="database:sync"
          description="Synchronises the database from source to target."
          depends="database:drop">
    <exec command="${drush.bin} sql-sync ${drush.source} ${drush.target} -y --no-cache"
          passthru="true"
          logoutput="true"
          checkreturn="true" />
  </target>

  <target name="database:sync-cached"
          description="Synchronises the database from source to target with dump cached locally."
          depends="database:drop">
    <exec command="${drush.bin} sql-sync ${drush.source} ${drush.target} -y --target-dump=${drush.tmpdir}/${phing.project.name}.sync.sql"
          passthru="true"
          logoutput="true"
          checkreturn="true" />
  </target>

</project>
